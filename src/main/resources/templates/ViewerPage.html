<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Viewer Page</title>

    <script th:inline="javascript">
        function loadPage(pageNumber) {
            const baseUrl = /*[[${details2.baseUrl}]]*/ 'baseUrlPlaceholder';
            const hash = /*[[${details2.hash}]]*/ 'hashPlaceholder';
            const dataSaver = /*[[${details2.dataSaver}]]*/ ['image1.jpg', 'image2.jpg'];

            if (pageNumber > 0 && pageNumber <= dataSaver.length) {
                const imageUrl = `${baseUrl}/data-saver/${hash}/${dataSaver[pageNumber - 1]}`;
                document.getElementById('manga-image').src = imageUrl;
                document.getElementById('page-select').value = pageNumber;
            } else {
                console.error('Invalid page number:', pageNumber);
            }
        }

        function navigatePage(offset) {
            let currentPage = parseInt(document.getElementById('page-select').value);
            const newPage = currentPage + offset;
            const maxPages = /*[[${details2.numberOfImages}]]*/ 10;

            if (newPage > 0 && newPage <= maxPages) {
                loadPage(newPage);
            }
        }

        function changeChapter() {
            const selectedChapter = document.getElementById('chapter-select').value;
            window.location.href = `/chapter-info?chapterId=${selectedChapter}`;
        }

        function changePage() {
            const selectedPage = parseInt(document.getElementById('page-select').value);
            loadPage(selectedPage);
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowLeft') {
                navigatePage(-1);
            } else if (event.key === 'ArrowRight') {
                navigatePage(1);
            }
        });

        // Load the first page on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadPage(1);
        });
    </script>

</head>
<body>

<select id="chapter-select" onchange="changeChapter()">
    <option th:each="chapter : ${details2.allChapters}" th:value="${chapter}" th:text="${chapter}" th:selected="${chapter eq details2.chapterNumber}"></option>
</select>

<select id="page-select" onchange="changePage()">
    <option th:each="i : ${#numbers.sequence(1, details2.numberOfImages)}" th:value="${i}" th:text="${i}" th:selected="${i == 1}"></option>
</select>

<div>
    <img id="manga-image" th:src="@{${details2.baseUrl}/data-saver/${details2.hash}/${details2.dataSaver[0]}}" alt="Manga Image">
</div>

<div class="navigation-buttons">
    <button type="button" onclick="navigatePage(-1)">Previous</button>
    <button type="button" onclick="navigatePage(1)">Next</button>
</div>


</body>
</html>
